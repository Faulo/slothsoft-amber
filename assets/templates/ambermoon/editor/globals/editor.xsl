<?xml version="1.0" encoding="UTF-8"?><xsl:stylesheet version="1.0" xmlns="http://www.w3.org/1999/xhtml" xmlns:xsl="http://www.w3.org/1999/XSL/Transform" xmlns:saa="http://schema.slothsoft.net/amber/amberdata" xmlns:sse="http://schema.slothsoft.net/savegame/editor" xmlns:sfm="http://schema.slothsoft.net/farah/module">    <xsl:import href="farah://slothsoft@amber/templates/ambermoon/editor/globals/savegame" />    <xsl:variable name="repository" select="string(//sfm:param[@name='repository']/@value)" />    <xsl:variable name="game" select="string(//sfm:param[@name='game']/@value)" />    <xsl:variable name="version" select="string(//sfm:param[@name='version']/@value)" />    <xsl:variable name="user" select="string(//sfm:param[@name='user']/@value)" />    <xsl:variable name="infoset" select="string(//sfm:param[@name='infosetId']/@value)" />    <xsl:variable name="archive" select="string(//sfm:param[@name='archivePath']/@value)" />    <xsl:template match="/sfm:fragment-info">        <div class="amber-editor amber-editor--game-{$game} amber-editor--infoset-{$infoset}" data-amber-game="{$game}" data-amber-version="{$version}" data-amber-infoset="{$infoset}" data-amber-archive="{$archive}">            <xsl:apply-templates select="sfm:document-info/sse:savegame" />        </div>    </xsl:template>    <xsl:template match="sse:savegame">        <xsl:variable name="selectedArchives" select="sse:archive[*]" />        <details open="open" class="amber-editor__settings">            <summary>Einstellungen</summary>            <form method="POST" action="?user={$user}" enctype="multipart/form-data">                <div>                    <label>                        <xsl:text>Aktuelle Spielstand-ID: </xsl:text>                        <input type="text" value="{$user}" readonly="readonly" size="40" />                    </label>                    <input type="hidden" name="repository" value="{$repository}" />                    <input type="hidden" name="game" value="{$game}" />                    <input type="hidden" name="version" value="{$version}" />                    <input type="hidden" name="infosetId" value="{$infoset}" />                </div>                <div>                    <h3>Bearbeitbare Dateien</h3>                    <table class="amber-editor__settings">                        <thead>                            <tr>                                <th>Datei</th>                                <th>Größe</th>                                <th>Letzte Änderung</th>                                <th>Eigene Version Hochladen</th>                            </tr>                        </thead>                        <tbody>                            <xsl:for-each select="sse:archive">                                <tr>                                    <td>                                        <label>                                            <input type="radio" name="archivePath" value="{@path}">                                                <xsl:if test="@path = $selectedArchives/@path">                                                    <xsl:attribute name="checked">checked</xsl:attribute>                                                </xsl:if>                                            </input>                                            <xsl:text> </xsl:text>                                            <xsl:value-of select="@name" />                                        </label>                                    </td>                                    <td>                                        <xsl:value-of select="ceiling(@size div 1000)" />                                        <xsl:text> kB</xsl:text>                                    </td>                                    <td>                                        <xsl:value-of select="@timestamp" />                                    </td>                                    <td>                                        <input type="file" name="upload[{@path}]" />                                    </td>                                </tr>                            </xsl:for-each>                        </tbody>                        <tfoot>                            <tr>                                <td colspan="3">                                    <button type="submit" name="action" value="view">Ausgewählte Datei öffnen</button>                                </td>                                <td>                                    <button type="submit" name="action" value="upload">Dateien hochladen</button>                                </td>                            </tr>                        </tfoot>                    </table>                </div>            </form>        </details>        <xsl:apply-templates select="$selectedArchives" mode="form" />    </xsl:template>    <xsl:template match="sse:archive" mode="form">        <form action="?user={$user}" method="POST" class="amber-editor__form amber-text">            <input type="hidden" name="repository" value="{$repository}" />            <input type="hidden" name="game" value="{$game}" />            <input type="hidden" name="version" value="{$version}" />            <input type="hidden" name="infosetId" value="{$infoset}" />            <input type="hidden" name="archivePath" value="{@path}" />            <h2 class="amber-text amber-text--cyan amber-text--large">                <xsl:value-of select="@name" />            </h2>            <xsl:apply-templates select="." mode="form-content" />            <nav class="amber-editor__actions">                <button name="action" type="submit" value="save">Speichern</button>                <button name="download" type="submit" value="{@path}">                    <xsl:text>Download</xsl:text>                </button>            </nav>        </form>    </xsl:template>    <xsl:template match="sse:archive" mode="form-content">        <xsl:choose>            <xsl:when test="count(sse:file) = 1">                <xsl:for-each select="sse:file">                    <xsl:call-template name="savegame.flex">                        <xsl:with-param name="items">                            <xsl:for-each select="*">                                <div>                                    <xsl:apply-templates select="." mode="item" />                                </div>                            </xsl:for-each>                        </xsl:with-param>                    </xsl:call-template>                </xsl:for-each>            </xsl:when>            <xsl:otherwise>                <xsl:call-template name="savegame.tabs">                    <xsl:with-param name="label" select="'Aktiver Eintrag:'" />                    <xsl:with-param name="options" select="sse:file/@file-name" />                    <xsl:with-param name="list">                        <xsl:for-each select="sse:file">                            <li>                                <xsl:call-template name="savegame.flex">                                    <xsl:with-param name="items">                                        <xsl:for-each select="*">                                            <div>                                                <xsl:apply-templates select="." mode="item" />                                            </div>                                        </xsl:for-each>                                    </xsl:with-param>                                </xsl:call-template>                            </li>                        </xsl:for-each>                    </xsl:with-param>                </xsl:call-template>            </xsl:otherwise>        </xsl:choose>    </xsl:template></xsl:stylesheet>